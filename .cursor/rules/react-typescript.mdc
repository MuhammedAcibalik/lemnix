---
globs: frontend/**/*.tsx,frontend/**/*.ts
description: React + TypeScript best practices ve FSD yapısı
---

# React + TypeScript Best Practices

## Feature-Sliced Design (FSD)

### Katman Hiyerarşisi
```
src/
├── app/           # Bootstrapping, providers, router
├── pages/         # Route-level pages
├── widgets/       # Bileşik UI blokları
├── features/      # Kullanıcı aksiyonları
├── entities/      # Domain modelleri
└── shared/        # Teknik primitifler
```

### Bağımlılık Yönü
```
app → pages → widgets → features → entities → shared
```
Yukarıdan aşağıya bağımlılık. Tersi yasak!

## Component Patterns

### Props Interface
```typescript
// ✅ İyi - Explicit ve readonly
interface ButtonProps {
  readonly variant: 'primary' | 'secondary';
  readonly size?: 'sm' | 'md' | 'lg';
  readonly disabled?: boolean;
  readonly onClick: () => void;
  readonly children: React.ReactNode;
}

export const Button: React.FC<ButtonProps> = ({ 
  variant, 
  size = 'md',
  disabled = false,
  onClick,
  children 
}) => {
  // ...
};
```

### Generic Components
```typescript
interface ListProps<T> {
  readonly items: readonly T[];
  readonly renderItem: (item: T) => React.ReactNode;
  readonly keyExtractor: (item: T) => string;
}

export function List<T>({ items, renderItem, keyExtractor }: ListProps<T>) {
  return (
    <ul>
      {items.map(item => (
        <li key={keyExtractor(item)}>
          {renderItem(item)}
        </li>
      ))}
    </ul>
  );
}
```

## Hooks Best Practices

### Custom Hooks
```typescript
// ✅ İyi - Single responsibility
function useUserData(userId: string) {
  const { data, error, isLoading } = useQuery({
    queryKey: ['user', userId],
    queryFn: () => fetchUser(userId),
    staleTime: 5 * 60 * 1000
  });

  return { user: data, error, isLoading };
}
```

### Dependency Arrays
```typescript
// ✅ İyi - Tüm dependencies dahil
useEffect(() => {
  const controller = new AbortController();
  
  fetchData(userId, controller.signal)
    .then(setData)
    .catch(handleError);
  
  return () => controller.abort();
}, [userId]); // ✅ Tam liste
```

## State Management

### Server State - TanStack Query
```typescript
// Query
const { data, isLoading, error } = useQuery({
  queryKey: ['products', filters],
  queryFn: () => fetchProducts(filters),
  staleTime: 5 * 60 * 1000,
  gcTime: 10 * 60 * 1000
});

// Mutation
const mutation = useMutation({
  mutationFn: createProduct,
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['products'] });
  }
});
```

### UI State - Zustand (minimal)
```typescript
interface AppStore {
  theme: 'light' | 'dark';
  setTheme: (theme: 'light' | 'dark') => void;
}

const useAppStore = create<AppStore>((set) => ({
  theme: 'light',
  setTheme: (theme) => set({ theme })
}));
```

## Forms - React Hook Form + Zod

```typescript
// Schema (single source of truth)
const userSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8),
  age: z.number().int().positive()
});

type UserFormData = z.infer<typeof userSchema>;

// Form
const { register, handleSubmit, formState: { errors } } = useForm<UserFormData>({
  resolver: zodResolver(userSchema)
});

const onSubmit = (data: UserFormData) => {
  // data is type-safe and validated
};
```

## Performance

### Memoization
```typescript
// ✅ Sadece gerektiğinde
const ExpensiveComponent = React.memo(({ data }: Props) => {
  const processed = useMemo(
    () => heavyComputation(data),
    [data]
  );
  
  const handleClick = useCallback(
    () => doSomething(data),
    [data]
  );
  
  return <div onClick={handleClick}>{processed}</div>;
});
```

### Code Splitting
```typescript
// Route-level lazy loading
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Settings = lazy(() => import('./pages/Settings'));

<Suspense fallback={<Loader />}>
  <Routes>
    <Route path="/dashboard" element={<Dashboard />} />
    <Route path="/settings" element={<Settings />} />
  </Routes>
</Suspense>
```

## Accessibility

```typescript
// ✅ İyi - ARIA labels, keyboard support
<button
  type="button"
  aria-label="Close dialog"
  aria-expanded={isOpen}
  onClick={handleClose}
  onKeyDown={(e) => e.key === 'Enter' && handleClose()}
>
  <Icon name="close" aria-hidden="true" />
</button>
```

## Type Safety

### Discriminated Unions
```typescript
type AsyncState<T> =
  | { status: 'idle' }
  | { status: 'loading' }
  | { status: 'success'; data: T }
  | { status: 'error'; error: Error };

function DataView<T>({ state }: { state: AsyncState<T> }) {
  switch (state.status) {
    case 'idle': return <div>Start loading</div>;
    case 'loading': return <Spinner />;
    case 'success': return <div>{state.data}</div>;
    case 'error': return <Error error={state.error} />;
  }
}
```

## Error Boundaries

```typescript
class ErrorBoundary extends React.Component<Props, State> {
  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    logger.error('React error boundary', { error, errorInfo });
  }

  render() {
    if (this.state.hasError) {
      return <ErrorFallback error={this.state.error} />;
    }
    return this.props.children;
  }
}
```
