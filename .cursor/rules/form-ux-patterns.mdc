---
description: Form UX best practices - validation, guidance, field management
globs: frontend/src/**/*Dialog*.tsx,frontend/src/**/forms/*.tsx,frontend/src/**/*Form*.tsx
---

# Form UX Best Practices

## Temel Prensipler

### Smart Defaults
Mümkün olduğunda akıllı varsayılan değerler kullan.

### Real-time Validation
Kullanıcı yazarken validation yap, submit'te değil.

### Clear Error Messages
Hata mesajları açıklayıcı ve çözüm odaklı olsun.

### Progressive Disclosure
Karmaşık formları aşamalara böl.

---

## Form State Management Pattern

```typescript
interface WorkOrderForm {
  workOrderId: string;
  size: string;
  priority: string;
  color: string;
  version: string;
  date: string;
  note: string;
  orderQuantity: string;
  profiles: ProfileFormItem[];
}

interface ProfileFormItem {
  id: string;
  profile: string;
  measurement: string;
  quantity: number;
}

// Component
export const MyFormDialog: React.FC = () => {
  const [form, setForm] = useState<WorkOrderForm>(DEFAULT_FORM);
  
  const handleChange = (field: keyof Omit<WorkOrderForm, 'profiles'>, value: string) => {
    setForm(prev => ({ ...prev, [field]: value }));
  };
  
  const handleProfileChange = (
    profileId: string, 
    field: keyof ProfileFormItem, 
    value: string | number
  ) => {
    setForm(prev => ({
      ...prev,
      profiles: prev.profiles.map(p =>
        p.id === profileId ? { ...p, [field]: value } : p
      )
    }));
  };
  
  // ...
};
```

---

## Real-time Validation

### Field-Level Validation
```typescript
const [errors, setErrors] = useState<Record<string, string>>({});

const validateField = (field: string, value: string): string | null => {
  switch (field) {
    case 'workOrderId':
      if (!value.trim()) return 'İş emri numarası gerekli';
      if (value.length < 3) return 'En az 3 karakter olmalı';
      return null;
    
    case 'orderQuantity':
      const num = parseInt(value);
      if (isNaN(num)) return 'Geçerli bir sayı girin';
      if (num < 1) return 'Miktar 1\'den küçük olamaz';
      return null;
    
    default:
      return null;
  }
};

const handleChange = (field: string, value: string) => {
  setForm(prev => ({ ...prev, [field]: value }));
  
  // Real-time validation
  const error = validateField(field, value);
  setErrors(prev => ({
    ...prev,
    [field]: error || undefined
  }));
};

// Usage
<TextField
  label="İş Emri No"
  value={form.workOrderId}
  onChange={(e) => handleChange('workOrderId', e.target.value)}
  error={!!errors.workOrderId}
  helperText={errors.workOrderId}
  required
/>
```

### Form-Level Validation
```typescript
const isFormValid = useMemo(() => {
  return (
    form.workOrderId.trim().length > 0 &&
    form.size.trim().length > 0 &&
    form.profiles.length > 0 &&
    form.profiles.every(p => 
      p.profile && 
      p.measurement && 
      p.quantity > 0
    )
  );
}, [form]);

// Disable submit if invalid
<Button 
  variant="contained" 
  onClick={handleSave}
  disabled={!isFormValid || isLoading}
>
  Kaydet
</Button>
```

### Step-by-Step Validation (Wizard)
```typescript
const isStepValid = useMemo(() => {
  switch (activeStep) {
    case 0: // Temel Bilgiler
      return form.workOrderId && form.size;
    
    case 1: // Profil Detayları
      return (
        form.profiles.length > 0 &&
        form.profiles.every(p => p.profile && p.measurement && p.quantity)
      );
    
    case 2: // Özet
      return true; // Summary is always valid if we reached here
    
    default:
      return false;
  }
}, [activeStep, form]);

// Next button state
<Button
  variant="contained"
  onClick={handleNext}
  disabled={!isStepValid}
  endIcon={<ArrowForwardIcon />}
>
  İleri
</Button>
```

---

## Input Adornments (Icons & Units)

### Icon Adornment
```typescript
import { InputAdornment } from '@mui/material';
import { Assignment as AssignmentIcon } from '@mui/icons-material';

<TextField
  label="İş Emri No"
  value={form.workOrderId}
  onChange={(e) => handleChange('workOrderId', e.target.value)}
  InputProps={{
    startAdornment: (
      <InputAdornment position="start">
        <AssignmentIcon sx={{ color: ds.colors.primary.main, fontSize: 18 }} />
      </InputAdornment>
    )
  }}
/>
```

### Unit Display (mm, cm, adet)
```typescript
<TextField
  label="Ölçü"
  value={profile.measurement}
  onChange={(e) => handleProfileChange(profile.id, 'measurement', e.target.value)}
  InputProps={{
    endAdornment: (
      <InputAdornment position="end">
        <Typography sx={{ 
          fontSize: '0.75rem', 
          color: ds.colors.text.secondary,
          fontWeight: 600,
        }}>
          mm
        </Typography>
      </InputAdornment>
    )
  }}
/>
```

### Combined (Icon + Unit)
```typescript
<TextField
  label="Uzunluk"
  value={length}
  onChange={(e) => setLength(e.target.value)}
  InputProps={{
    startAdornment: (
      <InputAdornment position="start">
        <StraightenIcon sx={{ fontSize: 18 }} />
      </InputAdornment>
    ),
    endAdornment: (
      <InputAdornment position="end">
        <Chip 
          label="mm" 
          size="small"
          sx={{ 
            height: 20,
            fontSize: '0.625rem',
            fontWeight: 600,
          }}
        />
      </InputAdornment>
    )
  }}
/>
```

---

## Quantity Counter Pattern

```typescript
const QuantityField: React.FC<{
  value: number;
  onChange: (value: number) => void;
  min?: number;
  max?: number;
}> = ({ value, onChange, min = 1, max = 9999 }) => {
  const ds = useDesignSystem();
  
  const handleIncrement = () => {
    if (value < max) onChange(value + 1);
  };
  
  const handleDecrement = () => {
    if (value > min) onChange(value - 1);
  };
  
  return (
    <Box sx={{ 
      display: 'flex', 
      alignItems: 'center', 
      gap: ds.spacing['1'],
      border: `1px solid ${ds.colors.neutral[300]}`,
      borderRadius: `${ds.borderRadius.md}px`,
      p: ds.spacing['1'],
    }}>
      <IconButton 
        size="small" 
        onClick={handleDecrement}
        disabled={value <= min}
      >
        <RemoveIcon fontSize="small" />
      </IconButton>
      
      <TextField
        type="number"
        value={value}
        onChange={(e) => {
          const num = parseInt(e.target.value);
          if (!isNaN(num) && num >= min && num <= max) {
            onChange(num);
          }
        }}
        sx={{
          width: 80,
          '& .MuiOutlinedInput-root': {
            '& fieldset': { border: 'none' },
          },
          '& input': {
            textAlign: 'center',
            fontWeight: 600,
          }
        }}
      />
      
      <IconButton 
        size="small" 
        onClick={handleIncrement}
        disabled={value >= max}
      >
        <AddIcon fontSize="small" />
      </IconButton>
    </Box>
  );
};

// Usage
<QuantityField
  value={profile.quantity}
  onChange={(val) => handleProfileChange(profile.id, 'quantity', val)}
  min={1}
  max={999}
/>
```

---

## Select Dropdown Pattern

### Simple Select
```typescript
<FormControl fullWidth>
  <InputLabel>Öncelik</InputLabel>
  <Select
    value={form.priority}
    onChange={(e) => handleChange('priority', e.target.value)}
    label="Öncelik"
  >
    <MenuItem value="low">Düşük</MenuItem>
    <MenuItem value="medium">Orta</MenuItem>
    <MenuItem value="high">Yüksek</MenuItem>
    <MenuItem value="urgent">Acil</MenuItem>
  </Select>
</FormControl>
```

### Select with Icons & Colors
```typescript
const PRIORITY_OPTIONS = [
  { value: 'low', label: 'Düşük', color: '#4caf50', icon: <ArrowDownwardIcon /> },
  { value: 'medium', label: 'Orta', color: '#ff9800', icon: <RemoveIcon /> },
  { value: 'high', label: 'Yüksek', color: '#f44336', icon: <ArrowUpwardIcon /> },
  { value: 'urgent', label: 'Acil', color: '#9c27b0', icon: <PriorityHighIcon /> },
];

<FormControl fullWidth>
  <InputLabel>Öncelik</InputLabel>
  <Select
    value={form.priority}
    onChange={(e) => handleChange('priority', e.target.value)}
    label="Öncelik"
    renderValue={(value) => {
      const option = PRIORITY_OPTIONS.find(o => o.value === value);
      return (
        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
          {option?.icon}
          <Typography>{option?.label}</Typography>
        </Box>
      );
    }}
  >
    {PRIORITY_OPTIONS.map((option) => (
      <MenuItem key={option.value} value={option.value}>
        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
          <Box sx={{ 
            width: 8, 
            height: 8, 
            borderRadius: '50%',
            backgroundColor: option.color,
          }} />
          {option.icon}
          <Typography>{option.label}</Typography>
        </Box>
      </MenuItem>
    ))}
  </Select>
</FormControl>
```

### Autocomplete (Large Lists)
```typescript
import { Autocomplete } from '@mui/material';

<Autocomplete
  options={availableSizes}
  value={form.size}
  onChange={(_, newValue) => handleChange('size', newValue || '')}
  loading={isLoadingSizes}
  renderInput={(params) => (
    <TextField
      {...params}
      label="Ebat"
      required
      InputProps={{
        ...params.InputProps,
        startAdornment: (
          <InputAdornment position="start">
            <StraightenIcon fontSize="small" />
          </InputAdornment>
        ),
        endAdornment: (
          <>
            {isLoadingSizes && <CircularProgress size={20} />}
            {params.InputProps.endAdornment}
          </>
        ),
      }}
    />
  )}
/>
```

---

## Dynamic List Management (Add/Remove Items)

### Profile List Pattern
```typescript
const [profiles, setProfiles] = useState<ProfileFormItem[]>([]);

const addProfile = () => {
  const newProfile: ProfileFormItem = {
    id: uuidv4(),
    profile: '',
    measurement: '',
    quantity: 1,
  };
  setProfiles(prev => [...prev, newProfile]);
};

const removeProfile = (id: string) => {
  setProfiles(prev => prev.filter(p => p.id !== id));
};

const updateProfile = (id: string, field: keyof ProfileFormItem, value: any) => {
  setProfiles(prev =>
    prev.map(p => p.id === id ? { ...p, [field]: value } : p)
  );
};

return (
  <Stack spacing={ds.spacing['3']}>
    {/* Profile List */}
    {profiles.map((profile, index) => (
      <Card key={profile.id} variant="outlined">
        <CardContent>
          <Stack direction="row" spacing={ds.spacing['2']} alignItems="flex-start">
            {/* Profile Type */}
            <TextField
              label="Profil Tipi"
              value={profile.profile}
              onChange={(e) => updateProfile(profile.id, 'profile', e.target.value)}
              sx={{ flex: 2 }}
            />
            
            {/* Measurement */}
            <TextField
              label="Ölçü"
              value={profile.measurement}
              onChange={(e) => updateProfile(profile.id, 'measurement', e.target.value)}
              sx={{ flex: 1 }}
              InputProps={{
                endAdornment: <InputAdornment position="end">mm</InputAdornment>
              }}
            />
            
            {/* Quantity */}
            <TextField
              label="Adet"
              type="number"
              value={profile.quantity}
              onChange={(e) => updateProfile(profile.id, 'quantity', parseInt(e.target.value))}
              sx={{ width: 100 }}
            />
            
            {/* Remove Button */}
            <IconButton 
              onClick={() => removeProfile(profile.id)}
              color="error"
              disabled={profiles.length === 1}
            >
              <DeleteIcon />
            </IconButton>
          </Stack>
        </CardContent>
      </Card>
    ))}
    
    {/* Add Button */}
    <Button
      variant="outlined"
      startIcon={<AddIcon />}
      onClick={addProfile}
      fullWidth
    >
      Profil Ekle
    </Button>
  </Stack>
);
```

---

## Smart Suggestions Pattern

### Autocomplete with Recent Values
```typescript
const [recentWorkOrders, setRecentWorkOrders] = useState<string[]>([]);

<Autocomplete
  freeSolo
  options={recentWorkOrders}
  value={form.workOrderId}
  onChange={(_, newValue) => handleChange('workOrderId', newValue || '')}
  renderInput={(params) => (
    <TextField
      {...params}
      label="İş Emri No"
      placeholder="Örn: 2024-001"
    />
  )}
  renderOption={(props, option) => (
    <li {...props}>
      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
        <HistoryIcon fontSize="small" color="action" />
        <Typography>{option}</Typography>
      </Box>
    </li>
  )}
/>
```

### Smart Combination Suggestions
```typescript
// Show combination suggestions based on size
const suggestedCombinations = useMemo(() => {
  if (!form.size) return [];
  return profileCombinations.filter(c => c.size === form.size);
}, [form.size, profileCombinations]);

{suggestedCombinations.length > 0 && (
  <Alert 
    severity="info" 
    icon={<LightbulbIcon />}
    action={
      <Button size="small" onClick={() => setShowCombinationDialog(true)}>
        Görüntüle
      </Button>
    }
  >
    Bu ebat için {suggestedCombinations.length} akıllı kombinasyon önerisi var
  </Alert>
)}
```

---

## Loading States in Forms

### Field-Level Loading
```typescript
<Autocomplete
  options={availableSizes}
  loading={isLoadingSizes}
  renderInput={(params) => (
    <TextField
      {...params}
      label="Ebat"
      InputProps={{
        ...params.InputProps,
        endAdornment: (
          <>
            {isLoadingSizes && <CircularProgress size={16} />}
            {params.InputProps.endAdornment}
          </>
        ),
      }}
    />
  )}
/>
```

### Submit Button Loading
```typescript
<Button
  variant="contained"
  onClick={handleSubmit}
  disabled={isSubmitting || !isFormValid}
  startIcon={isSubmitting ? <CircularProgress size={16} /> : <CheckCircleIcon />}
>
  {isSubmitting ? 'Kaydediliyor...' : 'Kaydet'}
</Button>
```

---

## Error Display Patterns

### Field Error
```typescript
<TextField
  label="İş Emri No"
  value={form.workOrderId}
  onChange={(e) => handleChange('workOrderId', e.target.value)}
  error={!!errors.workOrderId}
  helperText={errors.workOrderId || 'Örn: 2024-001'}
  required
/>
```

### Form-Level Error (Alert)
```typescript
{formError && (
  <Alert 
    severity="error"
    sx={{ mb: ds.spacing['3'] }}
    onClose={() => setFormError(null)}
  >
    {formError}
  </Alert>
)}
```

### Validation Summary
```typescript
{Object.keys(errors).length > 0 && (
  <Alert severity="warning" sx={{ mb: ds.spacing['3'] }}>
    <Typography variant="subtitle2" sx={{ fontWeight: 600, mb: 1 }}>
      Lütfen aşağıdaki alanları düzeltin:
    </Typography>
    <ul style={{ margin: 0, paddingLeft: 20 }}>
      {Object.entries(errors).map(([field, error]) => (
        <li key={field}>{error}</li>
      ))}
    </ul>
  </Alert>
)}
```

---

## Smart Defaults

### Auto-fill Date
```typescript
const [form, setForm] = useState<WorkOrderForm>({
  ...DEFAULT_FORM,
  date: new Date().toISOString().split('T')[0], // Today
});
```

### Copy from Last Entry
```typescript
const handleAddNew = () => {
  const lastEntry = entries[entries.length - 1];
  setForm({
    ...DEFAULT_FORM,
    // Copy size and priority from last entry
    size: lastEntry?.size || '',
    priority: lastEntry?.priority || 'medium',
  });
};
```

### Auto-calculate Total
```typescript
const totalLength = useMemo(() => {
  return profiles.reduce((sum, p) => {
    const measurement = parseInt(p.measurement) || 0;
    return sum + (measurement * p.quantity);
  }, 0);
}, [profiles]);

<Typography sx={{ fontWeight: 600 }}>
  Toplam Uzunluk: {totalLength} mm
</Typography>
```

---

## Responsive Form Layout

### Mobile: Stacked
### Desktop: Grid

```typescript
<Box sx={{
  display: 'grid',
  gridTemplateColumns: {
    xs: '1fr',              // Mobile: 1 column
    sm: 'repeat(2, 1fr)',   // Tablet: 2 columns
    md: 'repeat(3, 1fr)',   // Desktop: 3 columns
  },
  gap: ds.spacing['3'],
}}>
  <TextField label="İş Emri" />
  <TextField label="Ebat" />
  <TextField label="Öncelik" />
  <TextField label="Renk" />
  <TextField label="Versiyon" />
  <TextField label="Tarih" />
</Box>
```

---

## Accessibility

### Label Association
```typescript
// ✅ DOĞRU - label prop
<TextField label="İş Emri No" />

// ❌ YANLIŞ - placeholder only
<TextField placeholder="İş Emri No" />
```

### Required Field Indication
```typescript
<TextField
  label="İş Emri No"
  required
  helperText="Zorunlu alan"
/>
```

### Keyboard Navigation
```typescript
<TextField
  onKeyDown={(e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      if (isFormValid) {
        handleSubmit();
      }
    }
  }}
/>
```

---

## Anti-Pattern'ler (Yapma!)

### ❌ Submit Sonrası Validation
```typescript
// YANLIŞ - Submit butonuna basınca validation
const handleSubmit = () => {
  if (!form.workOrderId) {
    alert('İş emri gerekli!');
    return;
  }
  // ...
};

// DOĞRU - Real-time validation + disabled submit
const isValid = useMemo(() => !!form.workOrderId, [form]);
<Button disabled={!isValid} onClick={handleSubmit} />
```

### ❌ Generic Error Messages
```typescript
// YANLIŞ
helperText="Geçersiz değer"

// DOĞRU
helperText="İş emri numarası en az 3 karakter olmalı"
```

### ❌ Validation Olmadan Number Input
```typescript
// YANLIŞ
<TextField 
  type="number"
  value={quantity}
  onChange={(e) => setQuantity(e.target.value)}  // String!
/>

// DOĞRU
<TextField
  type="number"
  value={quantity}
  onChange={(e) => {
    const num = parseInt(e.target.value);
    if (!isNaN(num) && num > 0) {
      setQuantity(num);
    }
  }}
/>
```

---

## Checklist

- [ ] Real-time validation uygulandı mı?
- [ ] Error messages açıklayıcı mı?
- [ ] Required field'lar işaretli mi?
- [ ] Loading state'ler var mı?
- [ ] Smart defaults kullanıldı mı?
- [ ] Input adornment (icon/unit) var mı?
- [ ] Keyboard navigation destekli mi?
- [ ] Responsive layout var mı?
- [ ] Submit butonu validation'a göre disabled mı?

---

## Referanslar

- [NewItemDialog - Complete Form Example](mdc:frontend/src/components/CuttingListBuilder/dialogs/NewItemDialog.tsx)
- [EditItemDialog - Edit Form Pattern](mdc:frontend/src/components/CuttingListBuilder/dialogs/EditItemDialog.tsx)
- [CuttingListBuilder Types](mdc:frontend/src/components/CuttingListBuilder/types.ts)
